{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %}

{% block stylesheets %}
<style>
  /* Dashboard Container */
  .dashboard-container {
    padding: 24px;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    min-height: 100vh;
    position: relative;
  }

  .dashboard-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 200px;
    background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
    z-index: 0;
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
  }

  /* Stats Row */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    position: relative;
    z-index: 1;
  }

  .stats-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 24px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    animation: fadeInUp 0.5s ease-out forwards;
  }

  .stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .stats-title {
    font-size: 14px;
    color: #64748b;
    font-weight: 600;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .stats-value {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
    margin: 8px 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .stats-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 16px;
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(79, 70, 229, 0.1) 100%);
  }

  .stats-icon i {
    font-size: 24px;
    color: #4f46e5;
  }

  /* Section Styling */
  .section-wrapper {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .section-title {
    font-size: 24px;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 30px;
    padding-left: 20px;
    position: relative;
    display: flex;
    align-items: center;
  }

  .section-title:before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 6px;
    height: 30px;
    background: linear-gradient(to bottom, #4f46e5, #6366f1);
    border-radius: 6px;
  }

  /* Updated Chart Grid */
  .chart-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 30px;
  }

  /* Updated Chart Card */
  .chart-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 20px;
    height: 100%;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  /* Updated Chart Container */
  .chart-container {
    height: 250px;
    position: relative;
    padding: 10px;
  }

  /* Updated Chart Header */
  .chart-header {
    margin-bottom: 15px;
  }

  .chart-title {
    font-size: 16px;
    margin-bottom: 4px;
  }

  .chart-subtitle {
    font-size: 12px;
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .chart-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .chart-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* Chart Legend Styling */
  .chart-js-legend {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
  }

  .chart-js-legend ul {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  .chart-js-legend li {
    display: flex;
    align-items: center;
    font-size: 14px;
    color: #64748b;
  }

  .chart-js-legend li span {
    width: 14px;
    height: 14px;
    border-radius: 4px;
    margin-right: 10px;
    display: inline-block;
  }

  /* Additional Chart Styles */
  .metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 30px;
  }

  .metric-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .metric-value {
    font-size: 32px;
    font-weight: 700;
    color: #1e293b;
    margin: 8px 0;
    background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .metric-label {
    font-size: 16px;
    color: #64748b;
    margin: 0;
    font-weight: 500;
  }

  /* Animation for stats cards */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .stats-card:nth-child(1) {
    animation-delay: 0.1s;
  }

  .stats-card:nth-child(2) {
    animation-delay: 0.2s;
  }

  .stats-card:nth-child(3) {
    animation-delay: 0.3s;
  }

  .stats-card:nth-child(4) {
    animation-delay: 0.4s;
  }

  .stats-card:nth-child(5) {
    animation-delay: 0.5s;
  }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="dashboard-container">
  <!-- Stats Row -->
  <div class="stats-row">
    <!-- Mobile Banking -->
    <div class="stats-card">
      <div class="d-flex align-items-center">
        <div class="stats-icon purple">
          <i class="material-icons">savings</i>
        </div>
        <div>
          <p class="stats-title">Mobile Banking Savings</p>
          <h3 class="stats-value" id="savingsMobileBanking">Loading...</h3>
        </div>
      </div>
    </div>

    <!-- Bank Current -->
    <div class="stats-card">
      <div class="d-flex align-items-center">
        <div class="stats-icon purple">
          <i class="material-icons">account_balance</i>
        </div>
        <div>
          <p class="stats-title">Bank account (Current)</p>
          <h3 class="stats-value" id="bankCurrent">Loading...</h3>
        </div>
      </div>
    </div>

    <!-- Bank Savings -->
    <div class="stats-card">
      <div class="d-flex align-items-center">
        <div class="stats-icon purple">
          <i class="material-icons">account_balance_wallet</i>
        </div>
        <div>
          <p class="stats-title">Bank account (Savings)</p>
          <h3 class="stats-value" id="bankSavings">Loading...</h3>
        </div>
      </div>
    </div>

    <!-- Bank Everyday -->
    <div class="stats-card">
      <div class="d-flex align-items-center">
        <div class="stats-icon purple">
          <i class="material-icons">payments</i>
        </div>
        <div>
          <p class="stats-title">Bank account (Everyday)</p>
          <h3 class="stats-value" id="bankEveryday">Loading...</h3>
        </div>
      </div>
    </div>

    <!-- Postbank -->
    <div class="stats-card">
      <div class="d-flex align-items-center">
        <div class="stats-icon purple">
          <i class="material-icons">local_post_office</i>
        </div>
        <div>
          <p class="stats-title">Post bank</p>
          <h3 class="stats-value" id="postbank">Loading...</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Demographics Section -->
  <div class="section-wrapper">
    <h2 class="section-title">Demographic Overview</h2>
    <div class="chart-grid">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);"></div>
          <div>
            <h4 class="chart-title">Age Distribution</h4>
            <p class="chart-subtitle">Distribution of Age with Histogram and KDE</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="ageDistributionChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);"></div>
          <div>
            <h4 class="chart-title">Gender Distribution</h4>
            <p class="chart-subtitle">Breakdown by gender</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="genderDistributionChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"></div>
          <div>
            <h4 class="chart-title">Education Level</h4>
            <p class="chart-subtitle">Respondents by education</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="educationLevelChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);"></div>
          <div>
            <h4 class="chart-title">Residence Type</h4>
            <p class="chart-subtitle">Distribution of Residence Types</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="residenceTypeChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Retirement Section -->
  <div class="section-wrapper">
    <h2 class="section-title">Retirement and Financial Exclusion</h2>
    <div class="row">
      <div class="col-md-6">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-indicator" style="background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);"></div>
            <div>
              <h4 class="chart-title">Pension Uptake</h4>
              <p class="chart-subtitle">Breakdown by pension type</p>
            </div>
          </div>
          <div class="chart-container" style="height: 250px;">
            <canvas id="pensionChart2016"></canvas>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-indicator" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);"></div>
            <div>
              <h4 class="chart-title">Financial Exclusion</h4>
              <p class="chart-subtitle">Rate of financial exclusion</p>
            </div>
          </div>
          <div class="chart-container" style="height: 250px;">
            <canvas id="exclusionChart2016"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Financial Services Section -->
  <div class="section-wrapper">
    <h2 class="section-title">Financial Services Overview</h2>
    <div class="chart-grid">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);"></div>
          <div>
            <h4 class="chart-title">Banking Services Usage</h4>
            <p class="chart-subtitle">Distribution of banking services</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="bankingServicesChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);"></div>
          <div>
            <h4 class="chart-title">Mobile Money & Digital Services</h4>
            <p class="chart-subtitle">Digital financial services adoption</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="digitalServicesChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);"></div>
          <div>
            <h4 class="chart-title">Loan Sources Distribution</h4>
            <p class="chart-subtitle">Popular loan sources</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="loanSourcesChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);"></div>
          <div>
            <h4 class="chart-title">Credit Types</h4>
            <p class="chart-subtitle">Types of credit facilities used</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="creditTypesChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Insurance Coverage Section -->
  <div class="section-wrapper">
    <h2 class="section-title">Insurance Coverage Analysis</h2>
    <div class="chart-grid">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
          <div>
            <h4 class="chart-title">Insurance Types Distribution</h4>
            <p class="chart-subtitle">Types of insurance coverage</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="insuranceTypesChart2016"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-indicator" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);"></div>
          <div>
            <h4 class="chart-title">Health Insurance Coverage</h4>
            <p class="chart-subtitle">NHIF and other health insurance</p>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="healthInsuranceChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Savings Behavior Section -->
  <div class="section-wrapper">
    <h2 class="section-title">Savings Behavior Analysis</h2>
    <div class="row">
      <div class="col-md-6">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-indicator" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);"></div>
            <div>
              <h4 class="chart-title">Savings Methods</h4>
              <p class="chart-subtitle">Popular savings channels</p>
            </div>
          </div>
          <div class="chart-container" style="height: 250px;">
            <canvas id="savingsMethodsChart2016"></canvas>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-indicator" style="background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);"></div>
            <div>
              <h4 class="chart-title">Informal vs Formal Savings</h4>
              <p class="chart-subtitle">Distribution of savings types</p>
            </div>
          </div>
          <div class="chart-container" style="height: 250px;">
            <canvas id="savingsTypeChart2016"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>



  {% endblock %}

  {% block javascripts %}
  <!-- Core Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Popper.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

  <!-- Perfect Scrollbar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>

  <!-- Bootstrap Material Design -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/4.1.3/js/bootstrap-material-design.min.js"></script>

  <!-- Material Dashboard Core -->
  <script>
    $(document).ready(function () {
      // Initialize Bootstrap Material Design
      $('body').bootstrapMaterialDesign();

      // Initialize Perfect Scrollbar on the main panel
      if ($('.main-panel').length) {
        const mainPanel = document.querySelector('.main-panel');
        new PerfectScrollbar(mainPanel);
      }

      // Initialize Perfect Scrollbar on the sidebar
      if ($('.sidebar').length) {
        const sidebar = document.querySelector('.sidebar');
        new PerfectScrollbar(sidebar);
      }
    });
  </script>

  <script>
    // Chart.js global defaults
    Chart.defaults.font.family = "'Inter', sans-serif";
    Chart.defaults.font.size = 12;
    Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(255, 255, 255, 0.9)';
    Chart.defaults.plugins.tooltip.titleColor = '#1e293b';
    Chart.defaults.plugins.tooltip.bodyColor = '#64748b';
    Chart.defaults.plugins.tooltip.borderColor = 'rgba(0, 0, 0, 0.1)';
    Chart.defaults.plugins.tooltip.borderWidth = 1;
    Chart.defaults.plugins.tooltip.cornerRadius = 8;
    Chart.defaults.plugins.tooltip.padding = 12;
    Chart.defaults.plugins.legend.labels.padding = 20;
    Chart.defaults.plugins.legend.labels.usePointStyle = true;
    Chart.defaults.plugins.legend.labels.pointStyle = 'circle';
    Chart.defaults.plugins.legend.position = 'bottom';
    Chart.defaults.plugins.legend.labels.boxWidth = 8;
    Chart.defaults.plugins.legend.labels.padding = 15;

    // Initialize all charts when the document is ready
    document.addEventListener('DOMContentLoaded', async function () {
      try {
        console.log('Initializing demographic charts...');

        // Initialize Demographic Charts
        await Promise.all([
          loadChartData('/api/age-distribution/', 'ageDistributionChart', 'bar', {
            plugins: {
              title: {
                display: true,
                text: 'Age Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: { display: false }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)',
                  drawBorder: false
                },
                ticks: {
                  callback: function (value) {
                    return value + '%';
                  },
                  font: { size: 12 }
                }
              },
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  font: { size: 12 }
                }
              }
            },
            elements: {
              bar: {
                borderRadius: 8,
                backgroundColor: 'rgba(99, 102, 241, 0.8)'
              }
            }
          }),

          loadChartData('/api/gender-distribution/', 'genderDistributionChart', 'doughnut', {
            plugins: {
              title: {
                display: true,
                text: 'Gender Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${context.raw.toFixed(1)}%`;
                  }
                }
              }
            },
            cutout: '70%',
            elements: {
              arc: {
                borderWidth: 0
              }
            }
          }),

          loadChartData('/api/education-distribution/', 'educationLevelChart', 'bar', {
            plugins: {
              title: {
                display: true,
                text: 'Education Level Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: { display: false }
            },
            indexAxis: 'y',
            scales: {
              x: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)',
                  drawBorder: false
                },
                ticks: {
                  callback: function (value) {
                    return value + '%';
                  },
                  font: { size: 12 }
                }
              },
              y: {
                grid: {
                  display: false
                },
                ticks: {
                  font: { size: 12 }
                }
              }
            },
            elements: {
              bar: {
                borderRadius: 8,
                backgroundColor: 'rgba(99, 102, 241, 0.8)'
              }
            }
          }),

          loadChartData('/api/residence-type-distribution/', 'residenceTypeChart', 'pie', {
            plugins: {
              title: {
                display: true,
                text: 'Residence Type Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${context.raw.toFixed(1)}%`;
                  }
                }
              }
            },
            elements: {
              arc: {
                borderWidth: 0
              }
            }
          })
        ]);

        // Initialize Financial Stats with animation
        const statsResponse = await fetch("/api/financial-stats/");
        if (statsResponse.ok) {
          const statsData = await statsResponse.json();
          animateValue('savingsMobileBanking', 0, statsData.savings_mobile_banking || 0, 1000);
          animateValue('bankCurrent', 0, statsData.bank_current || 0, 1000);
          animateValue('bankSavings', 0, statsData.bank_savings || 0, 1000);
          animateValue('bankEveryday', 0, statsData.bank_everyday || 0, 1000);
          animateValue('postbank', 0, statsData.postbank || 0, 1000);
        }

        // Initialize Pension and Exclusion Charts for 2016
        await initializePensionAndExclusionCharts();

        // Initialize Banking Services Chart
        const bankingResponse = await fetch('/api/banking-services/');
        if (bankingResponse.ok) {
          const bankingData = await bankingResponse.json();
          createOrUpdateChart('bankingServicesChart', {
            labels: bankingData.labels,
            data: bankingData.data,
            backgroundColor: 'rgba(99, 102, 241, 0.8)',
            borderColor: 'rgba(99, 102, 241, 1)'
          }, 'bar', {
            plugins: {
              title: {
                display: true,
                text: 'Banking Services Usage',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)',
                  drawBorder: false
                },
                ticks: {
                  callback: function (value) {
                    return value + '%';
                  },
                  font: { size: 12 }
                }
              },
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  font: { size: 12 }
                }
              }
            },
            elements: {
              bar: {
                borderRadius: 8
              }
            }
          });
        }

        // Initialize Digital Services Chart
        const digitalResponse = await fetch('/api/digital-services/');
        if (digitalResponse.ok) {
          const digitalData = await digitalResponse.json();
          createOrUpdateChart('digitalServicesChart', {
            labels: digitalData.labels,
            data: digitalData.data,
            backgroundColor: 'rgba(99, 102, 241, 0.8)',
            borderColor: 'rgba(99, 102, 241, 1)'
          }, 'bar', {
            plugins: {
              title: {
                display: true,
                text: 'Digital Services Usage',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)',
                  drawBorder: false
                },
                ticks: {
                  callback: function (value) {
                    return value + '%';
                  },
                  font: { size: 12 }
                }
              },
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  font: { size: 12 }
                }
              }
            },
            elements: {
              bar: {
                borderRadius: 8
              }
            }
          });
        }

        // Initialize Loan Sources Chart
        const loanResponse = await fetch('/api/loan-sources/');
        if (loanResponse.ok) {
          const loanData = await loanResponse.json();
          createOrUpdateChart('loanSourcesChart', {
            labels: loanData.labels,
            data: loanData.data,
            backgroundColor: [
              'rgba(99, 102, 241, 0.8)',
              'rgba(79, 70, 229, 0.8)',
              'rgba(67, 56, 202, 0.8)',
              'rgba(55, 48, 163, 0.8)',
              'rgba(49, 46, 129, 0.8)'
            ],
            borderColor: [
              'rgba(99, 102, 241, 1)',
              'rgba(79, 70, 229, 1)',
              'rgba(67, 56, 202, 1)',
              'rgba(55, 48, 163, 1)',
              'rgba(49, 46, 129, 1)'
            ]
          }, 'doughnut', {
            plugins: {
              title: {
                display: true,
                text: 'Loan Sources Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                position: 'right',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${context.raw.toFixed(1)}%`;
                  }
                }
              }
            },
            elements: {
              arc: {
                borderWidth: 0
              }
            }
          });
        }

        // Credit Types Chart
        await loadChartData('/api/credit-types/', 'creditTypesChart', 'bar', {
          plugins: {
            title: {
              display: true,
              text: 'Distribution of Credit Types',
              font: { size: 16, weight: '600' },
              padding: { bottom: 20 }
            },
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  return context.parsed.y.toFixed(1) + '%';
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)',
                drawBorder: false
              },
              ticks: {
                callback: function (value) {
                  return value + '%';
                },
                font: { size: 12 }
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                font: { size: 12 }
              }
            }
          },
          elements: {
            bar: {
              borderRadius: 8,
              backgroundColor: 'rgba(99, 102, 241, 0.8)'
            }
          }
        });

        // Insurance Types Chart
        const insuranceResponse = await fetch('/api/insurance-types/');
        if (insuranceResponse.ok) {
          const insuranceData = await insuranceResponse.json();
          createOrUpdateChart('insuranceTypesChart2016', {
            labels: insuranceData.labels,
            data: insuranceData.data,
            backgroundColor: 'rgba(99, 102, 241, 0.2)',
            borderColor: 'rgba(99, 102, 241, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(99, 102, 241, 1)',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
          }, 'radar', {
            plugins: {
              title: {
                display: true,
                text: 'Insurance Types Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                display: false
              }
            },
            scales: {
              r: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                  callback: value => value + '%',
                  font: { size: 12 }
                }
              }
            }
          });
        }

        // Savings Methods Chart
        const savingsResponse = await fetch('/api/savings-methods/');
        if (savingsResponse.ok) {
          const savingsData = await savingsResponse.json();
          createOrUpdateChart('savingsMethodsChart2016', {
            labels: savingsData.labels,
            data: savingsData.data,
            backgroundColor: savingsData.colors || [
              'rgba(99, 102, 241, 0.8)',
              'rgba(79, 70, 229, 0.8)',
              'rgba(67, 56, 202, 0.8)',
              'rgba(55, 48, 163, 0.8)',
              'rgba(49, 46, 129, 0.8)'
            ],
            borderColor: [
              'rgba(99, 102, 241, 1)',
              'rgba(79, 70, 229, 1)',
              'rgba(67, 56, 202, 1)',
              'rgba(55, 48, 163, 1)',
              'rgba(49, 46, 129, 1)'
            ]
          }, 'polarArea', {
            plugins: {
              title: {
                display: true,
                text: 'Savings Methods Distribution',
                font: { size: 16, weight: '600' },
                padding: { bottom: 20 }
              },
              legend: {
                position: 'bottom',
                labels: {
                  padding: 20,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${context.raw.toFixed(1)}%`;
                  }
                }
              }
            },
            scales: {
              r: {
                beginAtZero: true,
                grid: {
                  color: 'rgba(0, 0, 0, 0.05)'
                },
                ticks: {
                  callback: value => value + '%',
                  font: { size: 12 }
                }
              }
            }
          });
        }

        // Initialize savings type distribution chart
        await initializeSavingsTypeChart();

      } catch (error) {
        console.error('Error initializing charts:', error);
      }
    });

    // Utility function to animate numbers
    function animateValue(elementId, start, end, duration) {
      const element = document.getElementById(elementId);
      if (!element) return;

      const range = end - start;
      const increment = range / (duration / 16);
      let current = start;

      const animate = () => {
        current += increment;
        element.textContent = Math.round(current).toLocaleString();

        if (current < end) {
          requestAnimationFrame(animate);
        } else {
          element.textContent = end.toLocaleString();
        }
      };

      animate();
    }

    // Utility function to create or update chart
    const createOrUpdateChart = (chartId, data, type = 'bar', options = {}) => {
      const canvas = document.getElementById(chartId);
      if (!canvas) {
        console.error(`Canvas element ${chartId} not found`);
        return;
      }

      // Destroy existing chart if it exists
      const existingChart = Chart.getChart(canvas);
      if (existingChart) {
        existingChart.destroy();
      }

      // Default options for percentage formatting
      const defaultOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          tooltip: {
            callbacks: {
              label: function (context) {
                return `${context.label}: ${context.raw.toFixed(1)}%`;
              }
            }
          }
        }
      };

      // Merge default options with provided options
      const chartOptions = { ...defaultOptions, ...options };

      // Create new chart
      new Chart(canvas.getContext('2d'), {
        type: type,
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Percentage',
            data: data.data,
            backgroundColor: data.backgroundColor || [
              'rgba(99, 102, 241, 0.8)',
              'rgba(79, 70, 229, 0.8)',
              'rgba(67, 56, 202, 0.8)',
              'rgba(55, 48, 163, 0.8)',
              'rgba(49, 46, 129, 0.8)'
            ],
            borderColor: data.borderColor || [
              'rgba(99, 102, 241, 1)',
              'rgba(79, 70, 229, 1)',
              'rgba(67, 56, 202, 1)',
              'rgba(55, 48, 163, 1)',
              'rgba(49, 46, 129, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: chartOptions
      });
    };

    // Utility function to load chart data
    const loadChartData = async (endpoint, chartId, type = 'bar', options = {}) => {
      try {
        console.log(`Fetching data from ${endpoint} for ${chartId}`);
        const response = await fetch(endpoint);
        console.log(`Response status for ${chartId}:`, response.status);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        console.log(`Data received for ${chartId}:`, data);

        // Handle different data formats
        let chartData = {
          labels: [],
          data: [],
          colors: []
        };

        // Handle pension/exclusion specific format
        if (data.pension || data.exclusion) {
          if (chartId.includes('pension')) {
            chartData = {
              labels: data.pension.labels,
              data: data.pension.data,
              colors: data.pension.colors
            };
          } else if (chartId.includes('exclusion')) {
            chartData = {
              labels: data.exclusion.labels,
              data: data.exclusion.data,
              colors: data.exclusion.colors
            };
          }
        }
        // Handle standard format
        else if (data.labels && data.data) {
          chartData = {
            labels: data.labels,
            data: data.data,
            colors: data.colors || [
              'rgba(99, 102, 241, 0.8)',
              'rgba(79, 70, 229, 0.8)',
              'rgba(67, 56, 202, 0.8)',
              'rgba(55, 48, 163, 0.8)',
              'rgba(49, 46, 129, 0.8)'
            ]
          };
        }
        // Handle error format
        else if (data.error) {
          throw new Error(data.error);
        }
        // Handle unexpected format
        else {
          throw new Error('Invalid data format');
        }

        if (!chartData.labels.length || !chartData.data.length) {
          throw new Error('No data available');
        }

        // Create or update the chart
        createOrUpdateChart(chartId, chartData, type, options);
      } catch (error) {
        console.error(`Error loading data for ${chartId}:`, error);
        const canvas = document.getElementById(chartId);
        if (canvas) {
          const ctx = canvas.getContext('2d');
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.font = '14px Inter';
          ctx.fillStyle = '#64748b';
          ctx.textAlign = 'center';
          ctx.fillText(`Error loading data: ${error.message}`, canvas.width / 2, canvas.height / 2);
        }
      }
    };

    // Initialize pension and exclusion charts
    async function initializePensionAndExclusionCharts() {
      try {
        const pensionCtx = document.getElementById('pensionChart2016');
        if (pensionCtx) {
          new Chart(pensionCtx, {
            type: 'bar',
            data: {
              labels: ['NSSF', 'MBAO', 'Other Pension'],
              datasets: [{
                label: 'Pension Uptake (%)',
                data: [10.79, 0.17, 1.26],
                backgroundColor: [
                  'rgba(244, 63, 94, 0.8)',  // Red
                  'rgba(225, 29, 72, 0.8)',  // Darker red
                  'rgba(190, 18, 60, 0.8)'   // Even darker red
                ],
                borderWidth: 0,
                borderRadius: 8
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  titleColor: '#1e293b',
                  bodyColor: '#64748b',
                  borderColor: 'rgba(0, 0, 0, 0.1)',
                  borderWidth: 1,
                  padding: 12,
                  cornerRadius: 8,
                  callbacks: {
                    label: function (context) {
                      return `${context.label}: ${context.raw}%`;
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    display: true,
                    color: 'rgba(0, 0, 0, 0.1)',
                    drawBorder: false
                  },
                  ticks: {
                    callback: function (value) {
                      return value + '%';
                    },
                    font: {
                      size: 12
                    },
                    color: '#64748b'
                  }
                },
                x: {
                  grid: {
                    display: false
                  },
                  ticks: {
                    font: {
                      size: 12
                    },
                    color: '#64748b'
                  }
                }
              }
            }
          });
        }

        const exclusionCtx = document.getElementById('exclusionChart2016');
        if (exclusionCtx) {
          new Chart(exclusionCtx, {
            type: 'doughnut',
            data: {
              labels: ['Financially Included', 'Financially Excluded'],
              datasets: [{
                data: [91.46, 8.54],
                backgroundColor: [
                  'rgba(236, 72, 153, 0.8)', // Pink
                  'rgba(219, 39, 119, 0.8)'  // Darker pink
                ],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: '70%',
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    boxWidth: 12,
                    usePointStyle: true,
                    pointStyle: 'circle',
                    font: {
                      size: 12
                    },
                    color: '#64748b'
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  titleColor: '#1e293b',
                  bodyColor: '#64748b',
                  borderColor: 'rgba(0, 0, 0, 0.1)',
                  borderWidth: 1,
                  padding: 12,
                  cornerRadius: 8,
                  callbacks: {
                    label: function (context) {
                      return `${context.label}: ${context.raw}%`;
                    }
                  }
                }
              }
            }
          });
        }
      } catch (error) {
        console.error('Error initializing pension and exclusion charts:', error);
      }
    }

    // Initialize health insurance chart
    async function initializeHealthInsuranceChart() {
      try {
        const healthInsuranceCtx = document.getElementById('healthInsuranceChart');
        if (healthInsuranceCtx) {
          new Chart(healthInsuranceCtx, {
            type: 'doughnut',
            data: {
              labels: ['NHIF', 'Other Health Insurance', 'No Insurance'],
              datasets: [{
                data: [19.69, 1.90, 78.41],
                backgroundColor: [
                  'rgba(99, 102, 241, 0.8)',  // Indigo
                  'rgba(79, 70, 229, 0.8)',   // Darker indigo
                  'rgba(67, 56, 202, 0.8)'    // Even darker indigo
                ],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: '70%',
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    boxWidth: 12,
                    usePointStyle: true,
                    pointStyle: 'circle',
                    font: {
                      size: 12
                    },
                    color: '#64748b'
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  titleColor: '#1e293b',
                  bodyColor: '#64748b',
                  borderColor: 'rgba(0, 0, 0, 0.1)',
                  borderWidth: 1,
                  padding: 12,
                  cornerRadius: 8,
                  callbacks: {
                    label: function (context) {
                      return `${context.label}: ${context.raw}%`;
                    }
                  }
                }
              }
            }
          });
        }
      } catch (error) {
        console.error('Error initializing health insurance chart:', error);
      }
    }

    // Initialize savings type distribution chart
    async function initializeSavingsTypeChart() {
      try {
        const savingsTypeCtx = document.getElementById('savingsTypeChart2016');
        if (savingsTypeCtx) {
          new Chart(savingsTypeCtx, {
            type: 'doughnut',
            data: {
              labels: ['Formal Savings', 'Informal Savings'],
              datasets: [{
                data: [42.3, 57.7],
                backgroundColor: [
                  'rgba(99, 102, 241, 0.8)',  // Indigo
                  'rgba(79, 70, 229, 0.8)'    // Darker indigo
                ],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: '70%',
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    boxWidth: 12,
                    usePointStyle: true,
                    pointStyle: 'circle',
                    font: {
                      size: 12
                    },
                    color: '#64748b'
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  titleColor: '#1e293b',
                  bodyColor: '#64748b',
                  borderColor: 'rgba(0, 0, 0, 0.1)',
                  borderWidth: 1,
                  padding: 12,
                  cornerRadius: 8,
                  callbacks: {
                    label: function (context) {
                      return `${context.label}: ${context.raw}%`;
                    }
                  }
                }
              }
            }
          });
        }
      } catch (error) {
        console.error('Error initializing savings type chart:', error);
      }
    }

    // Initialize all charts when the document is ready
    document.addEventListener('DOMContentLoaded', function () {
      initializeHealthInsuranceChart();
      initializePensionAndExclusionCharts();
      initializeSavingsTypeChart();
    });

  </script>

  <!-- Disable Material Dashboard Chartist Initialization -->
  <script>
    $(document).ready(function () {
      if (typeof md !== 'undefined' && typeof md.initDashboardPageCharts === 'function') {
        md.initDashboardPageCharts = function () {
          console.log('Chartist initialization disabled');
        };
      }
    });

  </script>

  <!-- Add this as a completely new script tag after all your existing scripts -->
  <script>
    // Separate initialization for financial charts only
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize financial charts after a small delay to avoid conflicts
      setTimeout(async function () {
        try {
          // Pension and Exclusion Stats
          const pensionResponse = await fetch('/api/pension-exclusion-stats-2016/pension/');
          if (pensionResponse.ok) {
            const pensionData = await pensionResponse.json();
            if (document.getElementById('pensionChart2016')) {
              new Chart(document.getElementById('pensionChart2016').getContext('2d'), {
                type: 'bar',
                data: {
                  labels: pensionData.labels,
                  datasets: [{
                    data: pensionData.data,
                    backgroundColor: pensionData.colors || [
                      '#f43f5e',
                      '#e11d48',
                      '#be123c'
                    ],
                    borderWidth: 0,
                    borderRadius: 4
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      display: false
                    },
                    tooltip: {
                      callbacks: {
                        label: function (context) {
                          return `${context.label}: ${context.raw}%`;
                        }
                      }
                    }
                  },
                  scales: {
                    y: {
                      beginAtZero: true,
                      grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.1)'
                      },
                      ticks: {
                        callback: function (value) {
                          return value + '%';
                        }
                      }
                    },
                    x: {
                      grid: {
                        display: false
                      }
                    }
                  }
                }
              });
            }

            if (document.getElementById('pensionPieChart')) {
              new Chart(document.getElementById('pensionPieChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                  labels: pensionData.labels,
                  datasets: [{
                    data: pensionData.data,
                    backgroundColor: pensionData.colors || [
                      '#64748b',
                      '#475569',
                      '#334155'
                    ],
                    borderWidth: 0
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      position: 'bottom',
                      labels: {
                        padding: 20,
                        boxWidth: 12,
                        usePointStyle: true,
                        pointStyle: 'circle'
                      }
                    },
                    tooltip: {
                      callbacks: {
                        label: function (context) {
                          return `${context.label}: ${context.raw}%`;
                        }
                      }
                    }
                  }
                }
              });
            }
          }

          // Financial Exclusion
          const exclusionResponse = await fetch('/api/pension-exclusion-stats-2016/exclusion/');
          if (exclusionResponse.ok) {
            const exclusionData = await exclusionResponse.json();
            console.log('Exclusion data 2016:', exclusionData);

            if (document.getElementById('exclusionGaugeChart2016')) {
              new Chart(document.getElementById('exclusionGaugeChart2016').getContext('2d'), {
                type: 'doughnut',
                data: {
                  labels: exclusionData.labels,
                  datasets: [{
                    data: exclusionData.data,
                    backgroundColor: exclusionData.colors || [
                      '#ec4899',
                      '#db2777'
                    ],
                    borderWidth: 0
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  cutout: '70%',
                  rotation: 270,
                  circumference: 180,
                  plugins: {
                    legend: {
                      position: 'bottom',
                      labels: {
                        padding: 20,
                        boxWidth: 12,
                        usePointStyle: true,
                        pointStyle: 'circle'
                      }
                    },
                    tooltip: {
                      callbacks: {
                        label: function (context) {
                          const sum = context.dataset.data.reduce((a, b) => a + b, 0);
                          const percentage = Math.round((context.raw / sum) * 100);
                          return `${context.label}: ${percentage}%`;
                        }
                      }
                    }
                  }
                }
              });
            }
          }

          // Banking Services
          const bankingResponse = await fetch('/api/banking-services-api/');
          if (bankingResponse.ok) {
            const bankingData = await bankingResponse.json();
            if (document.getElementById('bankingServicesChart')) {
              new Chart(document.getElementById('bankingServicesChart').getContext('2d'), {
                type: 'bar',
                data: {
                  labels: bankingData.labels,
                  datasets: [{
                    data: bankingData.data,
                    backgroundColor: bankingData.colors || [
                      '#06b6d4',
                      '#0891b2',
                      '#0e7490',
                      '#155e75'
                    ],
                    borderWidth: 0
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      display: false
                    }
                  },
                  scales: {
                    y: {
                      beginAtZero: true,
                      ticks: {
                        callback: value => value + '%'
                      }
                    }
                  }
                }
              });
            }
          }

          // Digital Services
          const digitalResponse = await fetch('/api/digital-services-api/');
          if (digitalResponse.ok) {
            const digitalData = await digitalResponse.json();
            if (document.getElementById('digitalServicesChart')) {
              new Chart(document.getElementById('digitalServicesChart').getContext('2d'), {
                type: 'bar',
                data: {
                  labels: digitalData.labels,
                  datasets: [{
                    data: digitalData.data,
                    backgroundColor: digitalData.colors || [
                      '#f97316',
                      '#ea580c',
                      '#c2410c'
                    ],
                    borderWidth: 0
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      display: false
                    }
                  },
                  scales: {
                    y: {
                      beginAtZero: true,
                      ticks: {
                        callback: value => value + '%'
                      }
                    }
                  }
                }
              });
            }
          }

          // Loan Sources
          const loanResponse = await fetch('/api/loan-sources-api/');
          if (loanResponse.ok) {
            const loanData = await loanResponse.json();
            if (document.getElementById('loanSourcesChart')) {
              new Chart(document.getElementById('loanSourcesChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                  labels: loanData.labels,
                  datasets: [{
                    data: loanData.data,
                    backgroundColor: loanData.colors || [
                      'rgba(99, 102, 241, 0.8)',
                      'rgba(79, 70, 229, 0.8)',
                      'rgba(67, 56, 202, 0.8)',
                      'rgba(55, 48, 163, 0.8)',
                      'rgba(49, 46, 129, 0.8)'
                    ],
                    borderColor: loanData.borderColor || [
                      'rgba(99, 102, 241, 1)',
                      'rgba(79, 70, 229, 1)',
                      'rgba(67, 56, 202, 1)',
                      'rgba(55, 48, 163, 1)',
                      'rgba(49, 46, 129, 1)'
                    ]
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    title: {
                      display: true,
                      text: 'Loan Sources Distribution',
                      font: { size: 16, weight: '600' },
                      padding: { bottom: 20 }
                    },
                    legend: {
                      position: 'right',
                      labels: {
                        padding: 20,
                        usePointStyle: true,
                        pointStyle: 'circle'
                      }
                    }
                  }
                }
              });
            }
          }

          // Credit Types
          const creditResponse = await fetch('/api/credit-types-api/');
          if (creditResponse.ok) {
            const creditData = await creditResponse.json();
            if (document.getElementById('creditTypesChart')) {
              new Chart(document.getElementById('creditTypesChart').getContext('2d'), {
                type: 'bar',
                data: {
                  labels: creditData.labels,
                  datasets: [{
                    data: creditData.data,
                    backgroundColor: creditData.colors || [
                      'rgba(99, 102, 241, 0.8)',
                      'rgba(79, 70, 229, 0.8)',
                      'rgba(67, 56, 202, 0.8)',
                      'rgba(55, 48, 163, 0.8)',
                      'rgba(49, 46, 129, 0.8)'
                    ],
                    borderColor: creditData.borderColor || [
                      'rgba(99, 102, 241, 1)',
                      'rgba(79, 70, 229, 1)',
                      'rgba(67, 56, 202, 1)',
                      'rgba(55, 48, 163, 1)',
                      'rgba(49, 46, 129, 1)'
                    ]
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    title: {
                      display: true,
                      text: 'Distribution of Credit Types',
                      font: { size: 16, weight: '600' },
                      padding: { bottom: 20 }
                    },
                    legend: {
                      display: false
                    }
                  }
                }
              });
            }
          }

          // Insurance Types
          const insuranceResponse = await fetch('/api/insurance-types-api/');
          if (insuranceResponse.ok) {
            const insuranceData = await insuranceResponse.json();
            if (document.getElementById('insuranceTypesChart2016')) {
              new Chart(document.getElementById('insuranceTypesChart2016').getContext('2d'), {
                type: 'radar',
                data: {
                  labels: insuranceData.labels,
                  datasets: [{
                    data: insuranceData.data,
                    backgroundColor: 'rgba(16, 185, 129, 0.2)',
                    borderColor: '#10b981',
                    borderWidth: 2
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    title: {
                      display: true,
                      text: 'Insurance Types Distribution',
                      font: { size: 16, weight: '600' },
                      padding: { bottom: 20 }
                    },
                    legend: {
                      display: false
                    }
                  }
                }
              });
            }
          }

          // Health Insurance
          const healthResponse = await fetch('/api/health-insurance-coverage/');
          if (healthResponse.ok) {
            const healthData = await healthResponse.json();
            if (document.getElementById('healthInsuranceChart')) {
              new Chart(document.getElementById('healthInsuranceChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                  labels: ['NHIF', 'Other Health Insurance', 'No Insurance'],
                  labels: healthData.labels,
                  datasets: [{
                    data: healthData.data,
                    backgroundColor: healthData.colors,
                    borderWidth: 0,
                    borderRadius: 4
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      display: false
                    },
                    tooltip: {
                      callbacks: {
                        label: function (context) {
                          return `${context.label}: ${context.raw}%`;
                        }
                      }
                    }
                  },
                  scales: {
                    y: {
                      beginAtZero: true,
                      grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.1)'
                      },
                      ticks: {
                        callback: function (value) {
                          return value + '%';
                        }
                      }
                    },
                    x: {
                      grid: {
                        display: false
                      }
                    }
                  }
                }
              });
            }
          }

          // Savings Methods
          const savingsResponse = await fetch('/api/savings-methods-api/');
          if (savingsResponse.ok) {
            const savingsData = await savingsResponse.json();
            if (document.getElementById('savingsMethodsChart2016')) {
              new Chart(document.getElementById('savingsMethodsChart2016').getContext('2d'), {
                type: 'polarArea',
                data: {
                  labels: savingsData.labels,
                  datasets: [{
                    data: savingsData.data,
                    backgroundColor: savingsData.colors || [
                      'rgba(99, 102, 241, 0.8)',
                      'rgba(79, 70, 229, 0.8)',
                      'rgba(67, 56, 202, 0.8)',
                      'rgba(55, 48, 163, 0.8)',
                      'rgba(49, 46, 129, 0.8)'
                    ],
                    borderWidth: 0
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      position: 'bottom'
                    }
                  }
                }
              });
            }
          }

          // Savings Type Distribution
          const savingsTypeResponse = await fetch('/api/savings-type-distribution-2016/');
          if (savingsTypeResponse.ok) {
            const savingsTypeData = await savingsTypeResponse.json();
            if (document.getElementById('savingsTypeChart2016')) {
              new Chart(document.getElementById('savingsTypeChart2016').getContext('2d'), {
                type: 'pie',
                data: {
                  labels: savingsTypeData.labels,
                  datasets: [{
                    data: savingsTypeData.data,
                    backgroundColor: savingsTypeData.colors || [
                      '#f43f5e',
                      '#e11d48'
                    ],
                    borderWidth: 0
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      position: 'bottom'
                    }
                  }
                }
              });
            }
          }

        } catch (error) {
          console.error('Error initializing financial charts:', error);
        }
      }, 1000); // Small delay to ensure DOM is ready
    });
  </script>

  <script src="https://unpkg.com/perfect-scrollbar@1.5.0/dist/perfect-scrollbar.min.js"></script>
  <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.min.js"></script>

  {% endblock javascripts %}